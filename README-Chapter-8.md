

-- Create Sessions Controller
- rails generate controller Sessions new
- add routes for sessions controller for new (get login) , delete (delete logout), create (post login)

-- Create Login Page
- Update new.html.erb just like done for users
- Use form_for(:session, url: login_path)

-- Add Create action and failure login
- add create action
- using the params[:session], get @user by User.find_by(email:)
- use @user.authenticate 
- if failed add flash[:danger] msg and render 'new'
- This will have the flash issue on subsequent request.

-- Adding a flash test
- rails generate integration_test users_login
- Add a test to test the entire flow and testing for assert flash.empty? towards the end
- This test would fail because of the issue with flash above
- Replace flash[] with flash.now[] and now tests should pass. 

-- Handling Log In
- Add log_in method in SessionHelper which does : session[:user_id] = user.id
- Add current_user method which finds the user based on session[:user_id] and returns it. 
- Add import statement in app/controller/application_controller.rb to include in all controllers. 
- in the create method of sessions_controller.rb add code to handle successful login. log_in and then redirect_to user

-- Changing layout links to show logged in user 
- Add a logged_in? method : !current_user.nil?
- Add dropdown and other links in the _header.html.erb if user is logged in and keep it if not logged in. 
- Add //= require bootstrap in app/assets/javascripts/application.js # NOT sure what this file does. 

-- Testing layout change : To add integration-test for successful log-in.
- Add User.digest method to create password_digest in models/user.rb
- Add a fixture with name, email and password_digest (generated by calling User.digest above) in test/fixtures/user.yml
- Add an integration test in test/integration/users_signup.rb. 
- Used "assert_redirected_to @user" to ensure the correct redirect
- Used "follow_redirect!" to check the links post the redirected page. 
- bundle exec rake test TEST=test/integration/users_login_test.rb TESTOPTS="--name test_login_with_valid_information"

-- Login upon signup 
- Call log_in from app/controllers/user_controller.rb # create
- Add a method is_signed_in? in the test/test_helpers.rb file as signed_in defined in sessions_helper.rb is NOT available in tests
- Add a line of code in the integration test for successful signup. 

-- Logging Out
- Add a log_out method in sessions_helper.rb to session.delete(:user_id) and set @current_user = nil
- Call this method from delete method in sessions_controller.rb and redirect_to root_path
- Update the test previously added for log_in to include log_out scenario as well. 

--
